<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SMARTDELAPAN â€” Administrasi Modern</title>
<link href="static/img/logo/2.png" rel="icon">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/home.css') }}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
<header>
 <div class="nav-container">
  <div class="logo">
    <img src="static/img/logo/4.png" alt="Logo Smartdelapan" >
  </div>
  <nav>

      <div class="hamburger" onclick="toggleMenu()">
        <div></div>
        <div></div>
        <div></div>
      </div>
      <ul id="navMenu">
         <li><a href="/main"><i class="fas fa-home"></i> Beranda</a></li>
        <li><a href="#layanan"><i class="fas fa-tools"></i> Layanan Utama</a></li>
        <li>
          <a href="#laporan"><i class="fas fa-file-invoice-dollar"></i> Laporan Keuangan â–¾</a>
          <ul>
            <li><a href="#pemasukan">Pemasukan</a></li>
            <li><a href="#pengeluaran">Pengeluaran</a></li>
          </ul>
        </li>
         <li><a href="#informasi"><i class="fas fa-info-circle"></i> Informasi</a></li>
        <li><a href="#kegiatan"><i class="fas fa-book"></i> Kegiatan</a></li>
        <!-- <li><a href="/logoutuser" ><i class="fas fa-sign-out-alt"></i> Keluar</a></li> -->
      </ul>
    </nav>
  </div>
</header>

<div style="background: var(--bg);"> 
    <section class="hero-slider">
        <div class="slides">
          
            <div class="slide active">
                <img src="{{ url_for('static', filename='img/logo/onboarding0.png') }}" alt="Banner 1">
            </div>
            <div class="slide">
                <img src="{{ url_for('static', filename='img/logo/onboarding1.png') }}" alt="Banner 2">
            </div>
            <div class="slide">
                <img src="{{ url_for('static', filename='img/logo/onboarding2.png') }}" alt="Banner 3">
            </div>
            <div class="slide">
                <img src="{{ url_for('static', filename='img/logo/onboarding3.png') }}" alt="Banner 4">
            </div>
        </div>
         <div class="slider-arrows">
        <div class="arrow arrow-left">&#10094;</div>
        <div class="arrow arrow-right">&#10095;</div>
    </div>
        
        
    </section>
    
<div class="slider-dots">
            </div>
 <div class="slider-captions">
    <!-- Slide 0: Data Keluarga -->
    <div class="caption active" id="cap-0">
        
      <p>Informasi jumlah keluarga yang terdata secara lengkap dan akurat.</p>
    </div>

    <!-- Slide 1: Pembuatan Surat -->
    <div class="caption" id="cap-1">
        
     <p>Informasi berbagai surat keterangan yang tersedia untuk warga.</p>

    </div>

    <!-- Slide 2: Iuran -->
    <div class="caption" id="cap-2">
        
      <p>Informasi iuran bulanan yang tersedia untuk warga.</p>

    </div>

    <!-- Slide 3: Laporan Keuangan -->
    <div class="caption" id="cap-3">
        
        <p>Transparansi laporan keuangan RT dengan lebih mudah dan cepat.</p>
    </div>
</div>

</div>



<main>
    <div style="background: var(--bg);"> 
    </div>
<section id="tentang-digipan" class="about-digipan-section">
  <div class="about-card-container">

    <div class="about-card primary-bg">
      <i class="fas fa-satellite-dish icon-large"></i>
      <h3>SMARTDELAPAN</h3>
      <p>Website ini menampilkan informasi dan publikasi mengenai kegiatan lingkungan RT 08 sebagai bentuk transparansi dan kemudahan akses bagi warga.</p>
    </div>

    <div class="about-card secondary-bg">
      <div class="feature-item">
        <i class="fas fa-check-circle"></i>
        <span>Ringkasan Data Warga untuk Keperluan Administratif</span>
      </div>

      <div class="feature-item">
        <i class="fas fa-check-circle"></i>
        <span>Informasi Prosedur dan Contoh Surat RT</span>
      </div>

      <div class="feature-item">
        <i class="fas fa-check-circle"></i>
        <span>Publikasi Ringkas Laporan Keuangan RT</span>
      </div>

      <div class="feature-item">
        <i class="fas fa-check-circle"></i>
        <span>Informasi Mekanisme Pembayaran Iuran</span>
      </div>

      <a href="#informasi" class="card-action-link">
        <i class="fas fa-info-circle"></i>
        Informasi Lengkap
      </a>
    </div>

  </div>
</section>

<section id="layanan">
  <h2 style="text-align:center; margin-bottom:30px;">LAYANAN INFORMASI</h2>
  <div class="card-grid" style="display:grid; grid-template-columns:repeat(auto-fit, minmax(250px, 1fr)); gap:20px;">

<!-- DATA KELUARGA (DENGAN INFORMASI UPDATE) -->
<div class="card" id="tambahKeluarga" style="padding:25px; border-radius:12px; box-shadow:0 6px 15px rgba(0,0,0,0.1); background:#fff; text-align:center;">
  <div class="card-content">
    <h3 style="margin-bottom:15px;"><i class="fas fa-user-friends" style="color:#17a2b8;"></i> Data Keluarga</h3>
    <p class="subtext">Informasi mengenai anggota keluarga, agar tercatat dan selalu diperbarui.</p>

    <div style="display:flex; justify-content:center; gap:15px; flex-wrap:wrap;">
      <div style="background:#e6f2ff; padding:10px 15px; border-radius:8px; font-weight:bold; color:#0176c1; min-width:140px;">
        <i class="fas fa-info-circle"></i> Jumlah Warga: <span id="total-keluarga">Loading...</span>
      </div>

      <div style="background:#ffe6e6; padding:10px 15px; border-radius:8px; font-weight:bold; color:#c10000; min-width:140px;">
        <i class="fas fa-user-tie"></i> Jumlah Keluarga: <span id="total-kepala-keluarga">Loading...</span>
      </div>
    </div>

   <!-- TERAKHIR UPDATE (FIXED) -->
<div style="
  margin-top:18px;
  font-size:13px;
  color:#777;
  display:flex;
  align-items:center;
  justify-content:center;
  gap:6px;
  line-height:1;
  padding-top:4px;
">
  <i class="fas fa-clock" style="font-size:14px; margin-top:1px;"></i>
  <span style="white-space:nowrap;">
   Diperbarui: <span id="last-update">â€“</span>
  </span>
</div>

  </div>
</div>



    <!-- IURAN WARGA (UI BAGUS) -->
    <div class="card" id="catatIuran" style="padding:25px; border-radius:12px; box-shadow:0 6px 15px rgba(0,0,0,0.1); background:#fff; text-align:center;">
      <div class="card-content">
        <h3 style="margin-bottom:15px;">
          <i class="fas fa-cash-register" style="color:#ffc107;"></i> Iuran Warga
        </h3>
       <p class="subtext">
          Informasi mengenai iuran bulanan warga secara transparan dan mudah dipantau.
        </p>

        <div style="display:flex; flex-direction:column; align-items:center; gap:10px;">

          <div style="background:#fff7e6; padding:10px 15px; border-radius:8px; color:#b36b00; font-weight:600; width:85%; text-align:center;">
            <i class="fas fa-coins"></i> Iuran Kebersihan
          </div>

          <div style="background:#fff7e6; padding:10px 15px; border-radius:8px; color:#b36b00; font-weight:600; width:85%; text-align:center;">
            <i class="fas fa-shield-alt"></i> Iuran Keamanan
          </div>

        </div>
      </div>
    </div>


    <!-- SURAT PENGANTAR (UI BAGUS) -->
    <div class="card" id="buatSurat" style="padding:25px; border-radius:12px; box-shadow:0 6px 15px rgba(0,0,0,0.1); background:#fff; text-align:center;">
      <div class="card-content">
        <h3 style="margin-bottom:15px;">
          <i class="fas fa-file-alt" style="color:#28a745;"></i> Surat Pengantar
        </h3>
       <p class="subtext">
  Informasi tentang jenis surat pengantar yang bisa diajukan warga.
</p>


       <div style="display:flex; flex-direction:column; align-items:center; gap:10px;">

  <div style="background:#e8f8ee; padding:10px 15px; border-radius:8px; color:#1d7b3a; font-weight:600; width:85%; text-align:center;">
    <i class="fas fa-home"></i> Surat Domisili
  </div>

  <div style="background:#e8f8ee; padding:10px 15px; border-radius:8px; color:#1d7b3a; font-weight:600; width:85%; text-align:center;">
    <i class="fas fa-id-badge"></i> Surat Pengantar
  </div>

  <div style="background:#e8f8ee; padding:10px 15px; border-radius:8px; color:#1d7b3a; font-weight:600; width:85%; text-align:center;">
    <i class="fas fa-exclamation-circle"></i> Surat Pernyataan Belum Menikah
  </div>

  <div style="background:#e8f8ee; padding:10px 15px; border-radius:8px; color:#1d7b3a; font-weight:600; width:85%; text-align:center;">
    <i class="fas fa-hands-helping"></i> Surat Pernyataan Tidak Mampu
  </div>

</div>


        </div>
      </div>
    </div>

  </div>
</section>


 <!-- <a href="/input_keluarga" class="card-action">

        <i class="fas fa-plus-circle" data-color="#ffc107"></i> Tambah / Perbarui Data

      </a> -->
      
<section id="laporan">
  <h2>LAPORAN KEUANGAN RT</h2>

  <div class="card-grid">
    <!-- Kartu Pemasukan -->
    <div class="card" id="pemasukan">
      <div class="card-content">
        <h3 class="text-green-600"><i class="fas fa-arrow-up"></i> Pemasukan RT</h3>
        <p class="subtext">Ringkasan jumlah dana yang diterima dari iuran warga serta kontribusi lain.</p>
        <div class="summary-box green">
          <div><strong>Total Pemasukan:</strong> <span id="total-pemasukan">Rp 0</span></div>
        </div>
      </div>
    </div>

    <!-- Kartu Pengeluaran -->
    <div class="card" id="pengeluaran">
      <div class="card-content">
        <h3><i class="fas fa-arrow-down" style="color: red;"></i> Pengeluaran RT</h3>
        <p class="subtext">Daftar pengeluaran kegiatan atau kebutuhan warga RT 08.</p>
        <div class="summary-box red">
          <div><strong>Total Pengeluaran:</strong> <span id="total-pengeluaran">Rp 0</span></div>
        </div>
        <h4>Rincian Pengeluaran:</h4>
        <ul id="pengeluaran-list" class="data-list"></ul>
      </div>
    </div>
</div>
   


<section id="informasi">
  <h2>INFORMASI</h2>
  <div class="card-grid single-card">
    <div class="card" id="peraturan-warga">
      <div class="card-content">
        <h3><i class="fas fa-scroll" data-color="#34acb0"></i> Tata Tertib Warga RT 08/01</h3>
        <p class="intro-text">
          Berikut daftar peraturan penting yang berlaku di lingkungan RT 08/01:
        </p>

       <ul class="rules-list" id="rules-container">
  <li>Loading...</li>
</ul>
<button id="lihat-peraturan-btn" class="btn-pdf">
  <i class="fas fa-file-pdf"></i> Lihat Aturan Lengkap
</button>

<div id="peraturan-modal" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>
    <iframe id="peraturan-pdf" width="100%" height="600px"></iframe>
  </div>
</div>


        <p class="note">
          Dengan mematuhi tata tertib ini, kita wujudkan lingkungan yang aman, nyaman, dan harmonis. ðŸŒ¿
        </p>
      </div>
    </div>
  </div>
</section>


</main>

<!-- <section id="bannerSection">
 <h2 style="margin-bottom: 20px; text-align:center;">KEGIATAN WARGA</h2>
  <div id="bannerCarousel"></div>
</section> -->


<section id="kegiatan" style="padding: 20px;">
   <h2 style="margin-bottom: 20px; text-align:center;">KEGIATAN WARGA</h2>
  <div id="kegiatanGrid"></div>
  <div id="toggleContainer" style="text-align:center; margin-top:16px;">
  <button id="toggleBtn" class="btn-toggle">Lihat Semua</button>
</div>
</section>
<div id="detailModal" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>
    <h2 id="modalTitle"></h2>
    <div id="modalImages" class="modal-images"></div>
    <p id="modalDescription"></p>
    <small id="modalDate"></small>
  </div>
</div>




<section id="bannerSection">
  <div id="bannerCarousel"></div>
</section> 
<footer>
  <p>Â© <span id="year"></span> SmartDelapan | all right reserved</a>.</p>
</footer>

<script>async function loadKegiatan() {
  const container = document.getElementById("kegiatanGrid");
  const toggleBtn = document.getElementById("toggleBtn");

  container.innerHTML = `<p>Loading...</p>`;
  const res = await fetch("/api/kegiatan");
  const data = await res.json();
  container.innerHTML = "";

  if (data.length === 0) {
    container.innerHTML = `<p>Tidak ada kegiatan.</p>`;
    toggleBtn.style.display = "none";
    return;
  }

  let showingAll = false;

  // Modal elements
  const modal = document.getElementById("detailModal");
  const modalTitle = document.getElementById("modalTitle");
  const modalImages = document.getElementById("modalImages"); // container untuk semua gambar
  const modalDescription = document.getElementById("modalDescription");
  const modalDate = document.getElementById("modalDate");
  const modalClose = document.querySelector(".close");

  // Event untuk close modal
  modalClose.addEventListener("click", () => {
    modal.style.display = "none";
  });

  window.addEventListener("click", (e) => {
    if (e.target === modal) {
      modal.style.display = "none";
    }
  });

  function render(items) {
    container.innerHTML = "";
    items.forEach(item => {
      let images = [];
      try {
        if (Array.isArray(item.image_urls)) images = item.image_urls;
        else images = JSON.parse(item.image_urls);
      } catch {
        images = [item.image_urls];
      }
      if (!images || images.length === 0) images = ["/static/img/default.jpg"];
      const firstImage = images[0];

      const dateObj = new Date(item.date);
      const formattedDate = dateObj.toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' });

      let description = item.description;
      if (description.length > 100) {
        description = description.substring(0, 100) + '...';
      }

      const card = document.createElement("div");
      card.classList.add("kegiatan-card");
      card.innerHTML = `
        <img src="${firstImage}" alt="${item.title}">
        <div class="card-body">
          <h3>${item.title}</h3>
          <p>${description}</p>
          <button class="btn-detail" data-id="${item.id}">Lihat Detail</button>
          <small>${formattedDate}</small>
        </div>
      `;
      container.appendChild(card);
    });

    toggleBtn.textContent = showingAll ? "Lihat Lebih Sedikit" : "Lihat Semua";

    // Event listener tombol detail
    document.querySelectorAll(".btn-detail").forEach(btn => {
      btn.addEventListener("click", async () => {
        const id = btn.dataset.id;
        const res = await fetch(`/api/kegiatan/${id}`);
        const data = await res.json();

        // Isi modal
        modalTitle.textContent = data.title;
        modalDescription.textContent = data.description;
        modalDate.textContent = new Date(data.date).toLocaleDateString('id-ID', { day:'numeric', month:'long', year:'numeric' });

        // Tampilkan semua gambar
       modalImages.innerHTML = "";
const urls = Array.isArray(data.image_urls) ? data.image_urls : [data.image_urls];
urls.forEach(url => {
  const img = document.createElement("img");
  img.src = url || "/static/img/default.jpg";
  modalImages.appendChild(img);
});


        modal.style.display = "block";
      });
    });
  }

  toggleBtn.addEventListener("click", () => {
    showingAll = !showingAll;
    render(showingAll ? data : data.slice(0, 3));
  });

  render(data.slice(0, 3));
}

loadKegiatan();



async function loadBannerCarousel() {
  const res = await fetch("/api/kegiatan");
  const data = await res.json();
  const container = document.getElementById("bannerCarousel");

  data.forEach(item => {
    let images = [];
    try {
      if (Array.isArray(item.image_urls)) images = item.image_urls;
      else images = JSON.parse(item.image_urls);
    } catch { images = [item.image_urls]; }
    if (!images || images.length === 0) images = ["/static/img/default.jpg"];
    const firstImage = images[0];

    const card = document.createElement("div");
    card.classList.add("banner-card");
    card.innerHTML = `<img src="${firstImage}" alt="">`;
    container.appendChild(card);
  });

  // Auto-slide
  const cards = container.querySelectorAll('.banner-card');
  let index = 0;
  const total = cards.length;
  const cardWidth = cards[0]?.offsetWidth + 15 || 235;

  setInterval(() => {
    index++;
    if (index >= total) index = 0;
    container.scrollTo({ left: index * cardWidth, behavior: 'smooth' });
  }, 3000);
}

loadBannerCarousel();

const modal = document.getElementById("detailModal");
const modalClose = document.querySelector(".close");

modalClose.addEventListener("click", () => {
  modal.style.display = "none";
});

window.addEventListener("click", (e) => {
  if (e.target === modal) {
    modal.style.display = "none";
  }
});

const btn = document.getElementById("lihat-peraturan-btn");
const pmodal = document.getElementById("peraturan-modal");
const close = pmodal.querySelector(".close");
const iframe = document.getElementById("peraturan-pdf");

btn.addEventListener("click", async () => {
  try {
    const res = await fetch("/api/peraturan/pdf");
    const data = await res.json();
    if (data.status && data.data.length > 0) {
      // Set src langsung ke proxy endpoint
      iframe.src = `/api/peraturan/pdf/proxy/${data.data[0].id}`;
      pmodal.style.display = "block"; // tampilkan modal
    } else {
      alert("Tidak ada PDF tersedia.");
    }
  } catch (err) {
    console.error(err);
    alert("Gagal memuat PDF.");
  }
});


close.addEventListener("click", () => {
  pmodal.style.display = "none";
  iframe.src = ""; // reset
});

window.addEventListener("click", (e) => {
  if (e.target == pmodal) {
    pmodal.style.display = "none";
    iframe.src = "";
  }
});



</script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="{{ url_for('static', filename='js/home.js') }}"></script>
<script src="https://kit.fontawesome.com/your-own-kit.js" crossorigin="anonymous" async></script>
</body>
</html>